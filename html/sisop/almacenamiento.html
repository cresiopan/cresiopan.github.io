<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2019-03-06 Wed 17:59 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Almacenamiento Persistente</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="/res/org.css"/>
                                        <script type="text/javascript" src="/res/org-info.js">

<script type="text/javascript" src="/style/org-info.js">
/**
 *
 * @source: /style/org-info.js
 *
 * @licstart  The following is the entire license notice for the
 *  JavaScript code in /style/org-info.js.
 *
 * Copyright (C) 2012-2018 Free Software Foundation, Inc.
 *
 *
 * The JavaScript code in this tag is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 *
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in /style/org-info.js.
 *
 */
</script>

<script type="text/javascript">

/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/

<!--/*--><![CDATA[/*><!--*/
org_html_manager.set("TOC_DEPTH", "2");
org_html_manager.set("LINK_HOME", "0");
org_html_manager.set("LINK_UP", "0");
org_html_manager.set("LOCAL_TOC", "0");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "underline");
org_html_manager.set("FIXED_TOC", "0");
org_html_manager.set("TOC", "1");
org_html_manager.set("VIEW", "showall");
org_html_manager.setup();  // activate after the parameters are set
/*]]>*///-->
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Almacenamiento Persistente</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org5130525">Sistema de Archivos</a>
<ul>
<li><a href="#org2148e7f">File System Abstraction</a></li>
<li><a href="#org2ca063b">API</a></li>
</ul>
</li>
<li><a href="#orgdf84873">Dispositivos de Almacenamiento</a></li>
<li><a href="#orgff64ae7">Archivos y Directorios</a>
<ul>
<li><a href="#org088a008">Implementacion</a>
<ul>
<li><a href="#orge86874f">Directories and index structures.</a></li>
<li><a href="#orge2936ae">Free space maps</a></li>
<li><a href="#org6599e74">Locality heuristics</a></li>
</ul>
</li>
<li><a href="#org574212d">Directorios</a></li>
<li><a href="#orgbb73a04">Archivos</a></li>
</ul>
</li>
<li><a href="#orgd76ad57">Almacenamiento Confiable</a></li>
</ul>
</div>
</div>
<div id="outline-container-org5130525" class="outline-2">
<h2 id="org5130525">Sistema de Archivos</h2>
<div class="outline-text-2" id="text-org5130525">
</div>
<div id="outline-container-org2148e7f" class="outline-3">
<h3 id="org2148e7f"><a href="#orgc8c6cdc">File</a> System Abstraction</h3>
<div class="outline-text-3" id="text-org2148e7f">
<p>
A <a id="org938781c">File system</a> (<a id="org40d00c0">fs</a>) is an operating system abstraction that provides
persistent, <a href="#orgb22e9ae">named data</a>. <a id="org4a0309f">Persistent data</a> is stored until it is
explicitly deleted, even if the computer storing it crashes or loses
power.  <a id="orgb22e9ae">Named data</a> can be accessed via a human-readable identifier
that the <a href="#org40d00c0">fs</a> associates with the <a href="#orgc8c6cdc">file</a>.
</p>

<p>
Two key parts to the <a href="#org40d00c0">fs</a> abstraction:
</p>
<ol class="org-ol">
<li>files, which define sets of <a href="#orgf091f8c">data</a>,</li>
<li>directories, which define names for files.</li>
</ol>

<p>
<a href="#orgc8c6cdc">File</a>. A <a id="orgc8c6cdc">file</a> is a named collection of <a href="#orgf091f8c">data</a> in a <a href="#orgc8c6cdc">file</a> system.
</p>

<p>
Files provide a higher-level abstraction than the underlying storage
device: they let a single, meaningful name refer to an (almost)
arbitrarily-sized amount of <a href="#orgf091f8c">data</a>. For example /path/to/foo.txt might
be stored on disk in blocks 0x0A713F28, 0xB3CA349A, and 0x33A229B8,
but it is much more convenient to refer to the <a href="#orgf091f8c">data</a> by its name than
by this list of disk addresses.
</p>

<p>
A <a href="#orgc8c6cdc">file</a>’s information has two parts, <a id="orgf668ca3">metadata</a> and <a id="orgf091f8c">data</a>. 
</p>

<pre class="example">
A file’s metadata is information about the file that is understood and
managed by the operating system. 
</pre>

<p>
For example:
</p>
<ul class="org-ul">
<li><a href="#orgc8c6cdc">file</a>’s size,</li>
<li>its modification time,</li>
<li>its owner, and</li>
<li>its security information such as whether it may be read, written, or
executed by the owner or by other users.</li>
</ul>

<pre class="example">
A file’s data can be whatever information a user or application puts in it.  
</pre>

<p>
From the point of view of the <a href="#org40d00c0">fs</a>, a <a href="#orgc8c6cdc">file</a>’s <a href="#orgf091f8c">data</a> is just an array of
untyped bytes. Applications can use these bytes to store whatever
information they want in whatever format they choose. 
</p>

<p>
<a id="org06c4797">Directory</a>. A <a href="#org06c4797">directory</a> provide names for files. 
</p>

<pre class="example">
a file directory is a list of human-readable names and
a mapping from each name to a specific underlying file or
directory.
</pre>

<p>
One common metaphor is that a <a href="#org06c4797">directory</a> is a folder that
contains documents (files) and other folders (directories).
</p>

<pre class="example">
the mapping between a name an the underlying file
</pre>

<p>
<a id="orgb4659b7">Volume</a>. Each instance of a <a href="#orgc8c6cdc">file</a> system manages files and
directories for a <a href="#orgb4659b7">volume</a>. 
</p>

<pre class="example">
A volume is a collection of physical storage resources that form a
logical storage device.
</pre>

<p>
A <a href="#orgb4659b7">volume</a> is an abstraction that corresponds to a logical disk. In the
simplest case, a <a href="#orgb4659b7">volume</a> corresponds to a single physical disk drive.
Alternatively, a single physical disk can be partitioned and store multiple
volumes or several physical disks can be combined so that a single <a href="#orgb4659b7">volume</a>
spans multiple physical disks.
</p>


<div class="figure">
<p><img src="./img/11.4.png" alt="11.4.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org2ca063b" class="outline-3">
<h3 id="org2ca063b">API</h3>
<div class="outline-text-3" id="text-org2ca063b">
<p>
Creating and deleting files. Processes create and destroy files with
create() and unlink().
</p>

<p>
Create() does two things: 
</p>
<ul class="org-ul">
<li>creates a new <a href="#orgc8c6cdc">file</a> that has initial <a href="#orgf668ca3">metadata</a> but no other <a href="#orgf091f8c">data</a>, and</li>
<li>creates a name for that <a href="#orgc8c6cdc">file</a> in a <a href="#org06c4797">directory</a>.</li>
</ul>

<p>
Link() creates a <a href="#org7556310">hard link</a> — a new path name for an existing <a href="#orgc8c6cdc">file</a>.
After a successful call to link(), there are multiple path names that
refer to the same underlying <a href="#orgc8c6cdc">file</a>.
</p>

<p>
Unlink() removes a name for a <a href="#orgc8c6cdc">file</a> from its <a href="#org06c4797">directory</a>. If a <a href="#orgc8c6cdc">file</a> has
multiple names or links, unlink() only removes the specified name,
leaving the <a href="#orgc8c6cdc">file</a> accessible via other names. If the specified name is
the last (or only) link to a <a href="#orgc8c6cdc">file</a>, then unlink() also deletes the
underlying <a href="#orgc8c6cdc">file</a> and frees its resources.
</p>

<p>
Mkdir() and rmdir() create and delete directories.
</p>


<p>
Open and close. To start accessing a <a href="#orgc8c6cdc">file</a>, a process calls open() to
get a <a id="org8fa11a8">file descriptor</a> it can use to refer to the open <a href="#orgc8c6cdc">file</a>. <a href="#org8fa11a8">File
descriptor</a> is Unix terminology; in other systems the descriptor may be
called a <a id="org8ff56b7">file handle</a> or a <a id="orgfcc812a">file stream</a>.
</p>

<p>
Operating systems require processes to explicitly open() files and
access them via <a href="#orgc8c6cdc">file</a> descriptors rather than simply passing the path
name to <a href="#org16d2b0f">read()</a> and <a href="#org85c3653">write()</a> calls for two reasons.
</p>

<p>
First, path parsing and permission checking can be done just when a
<a href="#orgc8c6cdc">file</a> is opened and need not be repeated on each read or write.
</p>

<p>
Second, when a process opens a <a href="#orgc8c6cdc">file</a>, the operating system creates a
<a href="#orgf091f8c">data</a> structure that stores information about the process’s open <a href="#orgc8c6cdc">file</a>
such as the <a href="#orgc8c6cdc">file</a>’s ID, whether the process can write or just read the
<a href="#orgc8c6cdc">file</a>, and a pointer to the process’s current position within the
<a href="#orgc8c6cdc">file</a>. 
</p>

<pre class="example">
The file descriptor can be thought of as a reference to the operating
system’s per-open-file data structure that the operating system will
use for managing the process’s access to the file.
</pre>

<p>
When an application is done using a <a href="#orgc8c6cdc">file</a>, it calls close(), which
releases the open <a href="#orgc8c6cdc">file</a> record in the operating system.
</p>

<p>
<a href="#orgc8c6cdc">File</a> access. While a <a href="#orgc8c6cdc">file</a> is open, an application can access the
<a href="#orgc8c6cdc">file</a>’s <a href="#orgf091f8c">data</a> in two ways. First, it can use the traditional procedural
interface, making system calls to <a id="org16d2b0f">read()</a> and <a id="org85c3653">write()</a> on an
open <a href="#orgc8c6cdc">file</a>. Calls to <a href="#org16d2b0f">read()</a> and <a href="#org85c3653">write()</a> start from the process’s
current <a href="#orgc8c6cdc">file</a> position, and they advance the current <a href="#orgc8c6cdc">file</a> position by
the number of bytes successfully read or written.  So, a sequence of
<a href="#org16d2b0f">read()</a> or <a href="#org85c3653">write()</a> calls moves sequentially through a <a href="#orgc8c6cdc">file</a>.  To support
random access within a <a href="#orgc8c6cdc">file</a>, the seek() call changes a process’s
current position for a specified open <a href="#orgc8c6cdc">file</a>.
</p>

<p>
Rather than using <a href="#org16d2b0f">read()</a> and <a href="#org85c3653">write()</a> to access a <a href="#orgc8c6cdc">file</a>’s <a href="#orgf091f8c">data</a>, an
application can use <a id="orgee7e639">mmap()</a> to establish a mapping between a
region of the process’s virtual memory and some region of the
<a href="#orgc8c6cdc">file</a>. Once a <a href="#orgc8c6cdc">file</a> has been mapped, memory loads and stores to that
virtual memory region will read and write the <a href="#orgc8c6cdc">file</a>’s <a href="#orgf091f8c">data</a> either by
accessing a shared page from the kernel’s <a href="#orgc8c6cdc">file</a> cache, or by triggering
a page fault exception that causes the kernel to fetch the desired
page of <a href="#orgf091f8c">data</a> from the <a href="#orgc8c6cdc">file</a> system into memory. When an application is
done with a <a href="#orgc8c6cdc">file</a>, it can call <a id="orge262332">munmap()</a> to remove the mappings.
</p>

<p>
Finally, the <a id="org86ca5d7">fsync()</a> call is important for reliability. When an
application updates a <a href="#orgc8c6cdc">file</a> via a <a href="#org85c3653">write()</a> or a memory store to a mapped
<a href="#orgc8c6cdc">file</a>, the updates are buffered in memory and written back to stable
storage at some future time. <a href="#org86ca5d7">Fsync()</a> ensures that all pending updates
for a <a href="#orgc8c6cdc">file</a> are written to persistent storage before the call
returns. Applications use this function for two purposes. First,
calling <a href="#org86ca5d7">fsync()</a> ensures that updates are durable and will not be lost
if there is a crash or power failure. Second, calling <a href="#org86ca5d7">fsync()</a> between
two updates ensures that the first is written to persistent storage
before the second.
</p>
</div>
</div>
</div>

<div id="outline-container-orgdf84873" class="outline-2">
<h2 id="orgdf84873">Dispositivos de Almacenamiento</h2>
</div>
<div id="outline-container-orgff64ae7" class="outline-2">
<h2 id="orgff64ae7">Archivos y Directorios</h2>
<div class="outline-text-2" id="text-orgff64ae7">
</div>
<div id="outline-container-org088a008" class="outline-3">
<h3 id="org088a008">Implementacion</h3>
<div class="outline-text-3" id="text-org088a008">
<p>
<a href="#orgc8c6cdc">File</a> systems must map <a href="#orgc8c6cdc">file</a> names and offsets to physical storage
blocks in a way that allows efficient access. Although there are many
different <a href="#orgc8c6cdc">file</a> systems, most implementations are based on four key
ideas: directories, index structures, free space maps, and locality
heuristics.
</p>


<div class="figure">
<p><img src="./img/13.1.png" alt="13.1.png" />
</p>
</div>
</div>

<div id="outline-container-orge86874f" class="outline-4">
<h4 id="orge86874f">Directories and index structures.</h4>
<div class="outline-text-4" id="text-orge86874f">
<p>
<a href="#orgc8c6cdc">file</a> systems map <a href="#orgc8c6cdc">file</a> names and <a href="#orgc8c6cdc">file</a> offsets to specific storage
blocks in two steps.  
</p>

<p>
First, they use directories to map human-readable <a href="#orgc8c6cdc">file</a> names to <a href="#orgc8c6cdc">file</a>
numbers. Directories are often just special files that contain lists
of <a href="#orgc8c6cdc">file</a> name -&gt; <a href="#orgc8c6cdc">file</a> number mappings.
</p>

<p>
Second, once a <a href="#orgc8c6cdc">file</a> name has been translated to a <a href="#orgc8c6cdc">file</a> number, <a href="#orgc8c6cdc">file</a>
systems use a persistently stored <a id="org85a1363">index structure</a> to locate the blocks
of the <a href="#orgc8c6cdc">file</a>. The <a href="#org85a1363">index structure</a> can be any <a href="#org4a0309f">persistent data</a> structure
that maps a <a href="#orgc8c6cdc">file</a> number and offset to a storage block.
</p>
</div>
</div>

<div id="outline-container-orge2936ae" class="outline-4">
<h4 id="orge2936ae">Free space maps</h4>
<div class="outline-text-4" id="text-orge2936ae">
<p>
<a href="#orgc8c6cdc">File</a> systems implement <a id="org2105eb6">free space map</a>s to track which storage
blocks are free and which are in use as files grow and shrink. At a
minimum, a <a href="#orgc8c6cdc">file</a> system’s <a href="#org2105eb6">free space map</a> must allow the <a href="#orgc8c6cdc">file</a> system to
find a free block when a <a href="#orgc8c6cdc">file</a> needs to grow, but because spatial
locality is important, most modern <a href="#orgc8c6cdc">file</a> systems implement free space
maps that allow them to find free blocks near a desired location. For
example, many <a href="#orgc8c6cdc">file</a> systems implement free space maps as bitmaps in
persistent storage.
</p>
</div>
</div>

<div id="outline-container-org6599e74" class="outline-4">
<h4 id="org6599e74">Locality heuristics</h4>
<div class="outline-text-4" id="text-org6599e74">
<p>
Directories and index structures allow <a href="#orgc8c6cdc">file</a> systems to locate
desired <a href="#orgc8c6cdc">file</a> <a href="#orgf091f8c">data</a> and <a href="#orgf668ca3">metadata</a> no matter where they are stored, and
free space maps allow them to locate the free space near any location
on the persistent storage device. These mechanisms allow <a href="#orgc8c6cdc">file</a> systems
to employ various policies to decide where a given block of a given
<a href="#orgc8c6cdc">file</a> should be stored.
</p>
</div>
</div>
</div>

<div id="outline-container-org574212d" class="outline-3">
<h3 id="org574212d">Directorios</h3>
<div class="outline-text-3" id="text-org574212d">
<p>
To access a <a href="#orgc8c6cdc">file</a>, the <a href="#orgc8c6cdc">file</a> system first translates the <a href="#orgc8c6cdc">file</a>’s name to
its number. For example, the <a href="#orgc8c6cdc">file</a> called /path/to/foo.txt might
internally known as <a href="#orgc8c6cdc">file</a> 66212871. <a href="#orgc8c6cdc">File</a> systems use directories to
store their mappings from human-readable names to internal <a href="#orgc8c6cdc">file</a>
numbers, and they organize these directories hierarchically so that
users can group related files and directories.
</p>

<p>
Solution: Use files to store directories. 
If the system needs to determine a <a href="#orgc8c6cdc">file</a>’s number, it can just open up
the appropriate <a href="#org06c4797">directory</a> <a href="#orgc8c6cdc">file</a> and scan through the <a href="#orgc8c6cdc">file</a> name/<a href="#orgc8c6cdc">file</a>
number pairs until it finds the right one.
</p>

<p>
<a href="./img/13.2.png">directory file</a>
</p>

<p>
the <a href="#orgc8c6cdc">file</a> number for <a href="#org06c4797">directory</a> "/home/tom" can be found by looking up
the name "tom" in the <a href="#org06c4797">directory</a> "/home", and the <a href="#orgc8c6cdc">file</a> number for
<a href="#org06c4797">directory</a> "/home" can be found by looking up the name "home" in the
root <a href="#org06c4797">directory</a> /.  
</p>


<div class="figure">
<p><img src="./img/13.3.png" alt="13.3.png" />
</p>
</div>

<p>
To achieve this the root <a href="#org06c4797">directory</a> has to have a known <a href="#orgc8c6cdc">file</a> number.
</p>

<p>
So, to read <a href="#orgc8c6cdc">file</a> /home/tom/foo.txt in Figure 13.3, we first read the
root <a href="#org06c4797">directory</a> by reading the <a href="#orgc8c6cdc">file</a> with the well-known root number
two. In that <a href="#orgc8c6cdc">file</a>, we search for the name home and find that <a href="#org06c4797">directory</a>
/home is stored in <a href="#orgc8c6cdc">file</a> 88026158. By reading <a href="#orgc8c6cdc">file</a> 88026158 and
searching for the name tom, we learn that <a href="#org06c4797">directory</a> /home/tom is
stored in <a href="#orgc8c6cdc">file</a> 5268830. Finally, by reading <a href="#orgc8c6cdc">file</a> 5268830 and searching
for the name foo.txt, we learn that /home/tom/foo.txt is <a href="#orgc8c6cdc">file</a>
number 66212871.
</p>

<p>
Although looking up a <a href="#orgc8c6cdc">file</a>’s number can take several steps, we expect
there to be locality (e.g., when one <a href="#orgc8c6cdc">file</a> in a <a href="#org06c4797">directory</a> is accessed,
other files in the <a href="#org06c4797">directory</a> are often likely to be accessed soon), so
we expect that caching will reduce the number of disk accesses needed
for most lookups.
</p>

<p>
Directories use a specialized API because they must control the
contents of files to prevent applications from corrupting the list of
name -&gt; <a href="#orgc8c6cdc">file</a><sub>number</sub> mappings.
</p>

<p>
<a href="#orgc8c6cdc">File</a> systems therefore provide special system calls for modifying
<a href="#org06c4797">directory</a> files.
</p>

<p>
These calls also bind together the creation or removal of a <a href="#orgc8c6cdc">file</a> and
the <a href="#orgc8c6cdc">file</a>’s <a href="#org06c4797">directory</a> entry.
</p>


<p>
<a href="#org06c4797">Directory</a> internals. Many early implementations simply stored linear
lists of <a href="#orgc8c6cdc">file</a> name, <a href="#orgc8c6cdc">file</a> number pairs in <a href="#org06c4797">directory</a> files. For example,
in the original version of the Linux ext2 <a href="#orgc8c6cdc">file</a> system, each <a href="#org06c4797">directory</a>
<a href="#orgc8c6cdc">file</a> stored a linked list of <a href="#org06c4797">directory</a> entries.
</p>


<div class="figure">
<p><img src="./img/13.4.png" alt="13.4.png" />
</p>
</div>

<p>
Simple lists work fine when the number of <a href="#org06c4797">directory</a> entries is small,
and that was the expected case for many early <a href="#orgc8c6cdc">file</a> systems.
</p>

<p>
To efficiently support directories with many entries, many recent <a href="#orgc8c6cdc">file</a>
systems including Linux XFS, Microsoft NTFS, and Oracle ZFS organize a
<a href="#org06c4797">directory</a>’s contents as a tree. Similarly, newer versions of ext2
augment the underlying linked list with an additional hash-based
structure to speed searches.
</p>


<div class="figure">
<p><img src="./img/13.5.png" alt="13.5.png" />
</p>
</div>

<p>
For example, Figure 13.5-(a) illustrates a tree-based <a href="#org06c4797">directory</a> structure
similar to the one used in Linux XFS, and Figure 13.5-(b) illustrates how
these records are physically arranged in a <a href="#org06c4797">directory</a> <a href="#orgc8c6cdc">file</a>.
</p>


<div class="figure">
<p><img src="./img/13.6.png" alt="13.6.png" />
</p>
</div>

<p>
<a id="org7556310">Hard link</a>s are multiple <a href="#orgc8c6cdc">file</a> <a href="#org06c4797">directory</a> entries that map
different path names to the same <a href="#orgc8c6cdc">file</a> number. Because a <a href="#orgc8c6cdc">file</a> number
can appear in multiple directories, <a href="#orgc8c6cdc">file</a> systems must ensure that a
<a href="#orgc8c6cdc">file</a> is only deleted when the last <a href="#org7556310">hard link</a> to it has been removed.
</p>

<p>
To properly implement garbage collection, <a href="#orgc8c6cdc">file</a> systems use reference
counts by storing with each <a href="#orgc8c6cdc">file</a> the number of hard links to it. When
a <a href="#orgc8c6cdc">file</a> is created, it has a reference count of one, and each
additional <a href="#org7556310">hard link</a> made to the <a href="#orgc8c6cdc">file</a>.
</p>

<p>
<a id="org5d0c336">soft link</a>s or <a id="orge8bb1bb">symbolic link</a>s are <a href="#org06c4797">directory</a> entries that
map one name to another name.
</p>
</div>
</div>

<div id="outline-container-orgbb73a04" class="outline-3">
<h3 id="orgbb73a04">Archivos</h3>
</div>
</div>
<div id="outline-container-orgd76ad57" class="outline-2">
<h2 id="orgd76ad57">Almacenamiento Confiable</h2>
</div>
</div>
<div id="postamble" class="status">
Last update: 2019-03-06
</div>
</body>
</html>
